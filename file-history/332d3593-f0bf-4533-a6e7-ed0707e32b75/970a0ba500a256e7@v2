#!/bin/bash
# MOSHI-INSPIRED SOFIA QUICK TEST
# Tests the optimized German voice pipeline

echo "üöÄ MOSHI-INSPIRED SOFIA - Quick Test"
echo "===================================="
echo ""

# Activate venv
source .venv/bin/activate

# Check voice model
if [ ! -f ~/.local/share/piper-voices/de_DE-thorsten-medium.onnx ]; then
    echo "‚ùå Voice model not found!"
    echo "Run: python -m piper.download_voices -l de_DE -n thorsten-medium"
    exit 1
fi

echo "‚úÖ Voice model found (60MB)"
echo ""

# Test Piper directly
echo "üé§ Testing Piper TTS..."
echo "Guten Tag, ich bin Sofia, Ihre virtuelle Rezeptionistin" | \
    piper --model ~/.local/share/piper-voices/de_DE-thorsten-medium.onnx \
          --output-raw > /dev/null 2>&1

if [ $? -eq 0 ]; then
    echo "‚úÖ Piper TTS working"
else
    echo "‚ùå Piper TTS failed"
    exit 1
fi

echo ""

# Check Ollama
echo "ü§ñ Checking Ollama..."
if ! ollama list &>/dev/null; then
    echo "‚ùå Ollama not running!"
    echo "Run: ollama serve"
    exit 1
fi

echo "‚úÖ Ollama running"
echo ""

# Check model
if ollama list | grep -q "gemma2:2b"; then
    echo "‚úÖ gemma2:2b found"
elif ollama list | grep -q "gemma"; then
    echo "‚úÖ Gemma model found (will use it)"
else
    echo "‚ö†Ô∏è  No Gemma model, will use first available"
fi

echo ""
echo "üéØ ALL CHECKS PASSED!"
echo ""
echo "Run Sofia:"
echo "  python agent.py console"
echo ""
echo "Performance Targets:"
echo "  - STT (faster-whisper): <500ms"
echo "  - LLM (Ollama): <200ms"
echo "  - TTS (Piper): <150ms"
echo "  - TOTAL: <1000ms (vs ~2600ms before)"
echo ""
echo "Say 'Auf Wiedersehen' to exit"
