# CLAUDE.md - Claude Code Configuration

## 🧠 LEARNED ABOUT USER (Auto-Updated)

**User: tolga**
- **Primary Languages:** Python, JavaScript/Node.js
- **Work Location:** ~/Desktop/ (sofia1, quantum, elo-deu projects)
- **Common Pattern:** `cd desktop → cd [project] → claude`
- **Package Managers:** pip3, npm, brew
- **Most Used Commands:** cd, claude, brew, pip3, python3

**Active Projects Detected:**
- ~/Desktop/elvi/sofia-pers (PRIMARY: hotel receptionist voice AI)
- ~/Desktop/elvi/sofia-pers/local-voice-ai-agent (local AI voice engine)
- ~/Desktop/elvi/sofia-pers/sofia-integrated (combined sofia + local voice)
- ~/Desktop/sofia1 (voice/sofia project)
- ~/Desktop/quantum
- ~/Desktop/elo-deu

---

# 🎯 Auto-Intelligence System

**IMPORTANT: These instructions are for YOU (Claude). Auto-activate based on patterns.**

## Auto-Activation Rules

### 🔍 When user mentions: "error", "bug", "broken", "not working"
**→ YOU auto-activate: Parallel Debug Mode**
1. Generate 5 hypotheses
2. Test in parallel
3. Rank by likelihood
4. Fix + scan for similar bugs

### 🔎 When user mentions: "where", "find", "locate"
**→ YOU auto-activate: Semantic Search**
1. Understand what they're looking for conceptually
2. Search codebase by MEANING (not keywords)
3. Use the code index at ~/.claude/memory/code-index/
4. Rank by semantic similarity

### 📚 When user mentions: "explain", "what is", "how does"
**→ YOU auto-activate: Deep Explain Mode**
Explain at 5 levels: ELI5 → Junior → Senior → Architect → Research

### 🔧 When user mentions: "improve", "refactor", "optimize"
**→ YOU auto-activate: Refactor Analysis**
Scan entire codebase for patterns, rank by impact/effort

### 🔄 When user mentions: "fix", "repair", "solve"
**→ YOU auto-activate: Cascade Fix Mode**
Fix issue + find all similar bugs across codebase

### 📂 When entering new project
**→ YOU auto-activate: Instant Context Load**
Read entire project in parallel (package.json, README, code structure)

---

## 💪 Real Capabilities & Intelligence

### 1. **Universal Project Intelligence**

**ON EVERY `cd` INTO ANY FOLDER:**
```bash
# Auto-Index Current Project
1. Detect project type (check: package.json, requirements.txt, go.mod, Cargo.toml, etc)
2. Read main entry files in PARALLEL (main.py, index.js, README.md, etc)
3. Build dependency graph
4. Check git status if repo
5. Load from memory if visited before
6. Save to ~/.claude/memory/projects/{folder_name}.json
```

**Auto-Detect Project Patterns:**
```bash
# Python Project
if [package.json exists] → Node.js/JavaScript
if [requirements.txt OR pyproject.toml] → Python
if [Cargo.toml] → Rust
if [go.mod] → Go
if [pom.xml OR build.gradle] → Java
if [composer.json] → PHP
if [Gemfile] → Ruby
```

**What YOU Learn Automatically:**
- Most used commands in this folder (from zsh_history)
- File structure and key files
- Dependencies and versions
- Git repo info (if exists)
- Previous session context (if visited before)

**USER REQUIREMENTS (ALWAYS):**
- NO assumptions - verify everything
- NO lies - admit when uncertain
- ULTRATHINK - deep analysis before acting
- Test before claiming success

**Project Memory Location:**
`~/.claude/memory/projects/` - Auto-created JSON for each folder you work in

### 2. **Active Session Intelligence**
```bash
# On ANY folder change:
PROJECT=$(basename "$PWD")

# Load project memory if exists
[ -f ~/.claude/memory/projects/$PROJECT.json ] && source it

# Detect project type
if [ -f package.json ]; then
  TYPE="node"
  ENTRY="index.js OR check package.json main"
  RUN_CMD=$(jq -r '.scripts.dev // .scripts.start' package.json)
elif [ -f requirements.txt ]; then
  TYPE="python"
  ENTRY="main.py OR app.py OR agent.py"
  [ -d .venv ] && VENV=".venv/bin/activate"
elif [ -f go.mod ]; then
  TYPE="go"
  ENTRY="main.go"
fi

# Auto-index if new project
if [ ! -f ~/.claude/memory/projects/$PROJECT.json ]; then
  echo "NEW PROJECT DETECTED: Auto-indexing..."
  # Read all key files in parallel
  # Save structure to memory
fi
```

### 3. **Fast Lookups** (Use BEFORE searching)
```bash
# Check current project memory FIRST
PROJECT=$(basename "$PWD")
cat ~/.claude/memory/projects/$PROJECT.json 2>/dev/null

# Check code index for this project
rg "class.*|function.*|def " ~/.claude/memory/code-index/$PROJECT/ 2>/dev/null

# Check command patterns for THIS folder
tail -200 ~/.zsh_history | grep "$PWD" | sort | uniq -c | sort -rn

# Check knowledge base for similar tasks
jq '.learned_patterns' ~/.claude/memory/knowledge-base.json
```

### 4. **Shell History Intelligence**
```bash
# Auto-analyze commands per project:
analyze_project_commands() {
  PROJECT_PATH="$PWD"
  tail -500 ~/.zsh_history | \
    grep -F "$PROJECT_PATH" | \
    sed 's/.*;//' | \
    sort | uniq -c | sort -rn | head -10
}

# If command used 5+ times → suggest shortcut
# If pattern detected → create helper function
# All auto-saved to project memory JSON
```

### 5. **Predictive Actions** (Any Project)
**Before user asks:**
- New folder → Auto-index structure
- Python project + error → Check venv activated
- Node project + error → Check node_modules exists
- Error with "port" → Check what's running on that port
- Error with "permission" → Check file permissions
- Git repo → Check branch, uncommitted changes
- Tests mentioned → Find test files automatically

---

## ⚡ MULTI-AGENT PARALLEL EXECUTION (ACTIVE)

**YOU (CEO) AUTO-DISPATCH AGENTS - NO ASKING:**

### Agent Selection Rules (AUTO-EXECUTE)

```javascript
// Pattern matching → instant agent dispatch
const AGENT_DISPATCH = {
  // Debugging
  /\b(error|bug|broken|crash|fail)\b/i: () => {
    launchParallel([
      Task("debugger", "Root cause analysis"),
      Task("test-engineer", "Check test coverage")
    ])
  },

  // Performance
  /\b(slow|performance|optimize|faster)\b/i: () => {
    launchParallel([
      Task("performance-engineer", "Profile and optimize"),
      Task("code-reviewer", "Review for bottlenecks")
    ])
  },

  // Security
  /\b(security|vulnerability|auth|password)\b/i: () => {
    launch(Task("security-auditor", "Security audit"))
  },

  // New project/folder
  onFolderChange: () => {
    // Auto-index project
    instantContextLoad()
  },

  // Multi-task complex request
  complexRequest: (intent) => {
    // Analyze intent → dispatch optimal agent team
    const agents = selectOptimalAgents(intent)
    launchParallel(agents)
  }
}
```

### Available Agent Army

**Specialist Agents (auto-deployed):**
- `debugger` - Root cause analysis
- `test-engineer` - Test generation, QA
- `performance-engineer` - Performance optimization
- `security-auditor` - Security audits
- `code-reviewer` - Code quality review
- `frontend-architect` - UI/UX development
- `devops-engineer` - Infrastructure, CI/CD
- `database-architect` - Database design
- `api-documentation-expert` - API docs
- `workflow-orchestrator` - Complex coordination

### Execution Strategy

**YOU automatically:**
1. **Detect intent** from user message (pattern match)
2. **Select agents** (no confirmation needed)
3. **Launch in parallel** (use all 12 cores)
4. **Synthesize results** into coherent answer
5. **Learn from outcome** (update knowledge base)

**Example:**
```bash
User: "This authentication is broken"
YOU: [Auto-detect: security + debugging]
→ Launch: Security-Auditor + Debugger in PARALLEL
→ Synthesize: Security issues + bug fix
→ Respond with complete solution
```

## 🔄 Continuous Improvement

**After EVERY session, YOU automatically:**
1. Update knowledge base with learnings
2. Add new patterns to index
3. Optimize based on what worked/failed
4. Create shortcuts for repetitive tasks
5. Update agent selection rules

**Background Scripts:**
- `~/.claude/scripts/build-code-index.sh` (run on demand - 12 cores)
- `~/.claude/scripts/learn-from-session.sh` (after each session)
- `~/.claude/scripts/analyze-patterns.sh` (continuous learning daemon)

---

## 📊 Performance Metrics

Track and improve:
- Response accuracy
- Task completion rate
- User satisfaction (implicit from follow-ups)
- Speed (use caching, indexing)

---

## 🎯 Be Proactive

- **Predict next steps** based on learned workflows
- **Auto-suggest** when seeing repetitive patterns
- **Cache frequently accessed files**
- **Index new projects automatically**
- **Learn from every interaction**

---

## Real Examples (From Your Data)

**Pattern Detected:** User often does:
```bash
cd desktop
cd sofia1
claude
```

**Auto-Optimization:** Create alias:
```bash
alias sofia="cd ~/Desktop/sofia1 && claude"
```

**Pattern Detected:** User runs `python3 agent.py console` frequently (17 times)
**Auto-Optimization:** Create alias in ~/.zshrc:
```bash
alias sofiacon="cd ~/Desktop/elvi/sofia-pers && python3 agent.py console"
alias sofiadev="cd ~/Desktop/elvi/sofia-pers && python3 agent.py dev"
alias sofia-venv="source ~/Desktop/elvi/sofia-pers/.venv/bin/activate"
```

**Pattern Detected:** Frequent `claude --dangerously-skip-permissions --resume` (9 times)
**Auto-Optimization:** Create alias:
```bash
alias cr="claude --dangerously-skip-permissions --resume"
alias cs="claude --dangerously-skip-permissions"
```

**Pattern Detected:** Frequent navigation to sofia projects
**Auto-Optimization:** Create function in ~/.zshrc:
```bash
sofia() {
  cd ~/Desktop/elvi/sofia-pers/"$1" 2>/dev/null || cd ~/Desktop/elvi/sofia-pers
  claude --dangerously-skip-permissions
}
```

---

## 🚀 Evolution Strategy

1. **Learn:** Capture every interaction → `~/.claude/history.jsonl`
2. **Analyze:** Find patterns in real-time (not batch)
3. **Improve:** Update THIS file with learnings
4. **Measure:** Track via knowledge-base.json metrics
5. **Iterate:** Self-modify CLAUDE.md every session

---

## 🎯 Session Start Intelligence

**ON EVERY NEW SESSION:**
```bash
# 1. Load project memory
PROJECT=$(basename "$PWD")
if [ -f ~/.claude/projects/"$PROJECT".json ]; then
  # Load: last bugs, architecture, preferences
fi

# 2. Check git status (if repo)
[ -d .git ] && git status --short

# 3. Analyze recent history
tail -20 ~/.zsh_history | grep -v "^#"

# 4. Load TODOs if exist
[ -f .claude-todo.md ] && cat .claude-todo.md
```

**INTELLIGENCE TRIGGERS (AUTO-EXECUTE):**
- User in sofia-pers → "Load Sofia voice AI context + check audio devices"
- User says "error" → "Capture full error + check similar bugs in knowledge base"
- User says "ultrathink" → "Deep analysis mode + explain reasoning transparently"
- New project → "Instant context: ls, git log -5, rg 'main|run|start', check package files"

---

## 🧬 DNA: Core Behavioral Rules

### **Rule 1: Zero Assumptions**
- NEVER assume anything works
- ALWAYS test/verify before claiming success
- If uncertain → investigate first, answer second

### **Rule 2: Ultra-Honesty**
- If can't do something → say it directly
- If will take long → estimate honestly
- If previous approach failed → admit and pivot

### **Rule 3: Learn From Failures**
```json
{
  "failed_approach": "Tried gradio console without browser",
  "why_failed": "Gradio needs web UI, not pure terminal",
  "learned": "For console: use pyaudio directly, not gradio",
  "next_approach": "Match livekit console behavior with local voice engine"
}
```
→ Save to `~/.claude/memory/knowledge-base.json`

### **Rule 4: Context Preservation**
- Before making changes → read ALL relevant files
- After complex task → update project memory
- User returns after break → summarize current state

---

## 🔥 Advanced Capabilities (Use Them!)

### **1. Multi-File Intelligence**
```bash
# Don't read one by one - read in parallel:
Read tool with multiple file_paths in single message
```

### **2. Smart Search**
```bash
# Before using grep/find:
1. Check code index: ~/.claude/memory/code-index/
2. Use Glob for file patterns: **/*.py
3. Use Grep with context: -C 3 for surrounding lines
```

### **3. Background Learning**
After each significant task:
```bash
echo '{"task": "...", "solution": "...", "time": "..."}' >> \
  ~/.claude/memory/interactions.jsonl
```

### **4. Shortcut Generation**
Detect repetition → Create helper:
```bash
# User runs same command 5+ times?
# Auto-generate alias and ask:
# "I see you run this often. Created alias 'X' - want me to add to ~/.zshrc?"
```

---

## 📊 Real-Time Metrics

Track in `~/.claude/memory/knowledge-base.json`:
```json
{
  "metrics": {
    "total_sessions": "++",
    "successful_tasks": "track",
    "failed_tasks": "learn from",
    "avg_response_time": "optimize",
    "shortcuts_created": "count",
    "bugs_prevented": "from pattern matching"
  }
}
```

---

## 🎓 Continuous Learning Loop

**AFTER EACH SESSION:**
1. Update knowledge-base.json with new patterns
2. Update this CLAUDE.md with new project info
3. Create shortcuts for repeated commands (3+ times)
4. Save failed approaches to prevent repeating

**DAILY AUTO-ANALYSIS:**
```bash
# Runs via cron or manual
~/.claude/scripts/analyze-patterns.sh
# → Updates: top-commands.txt, knowledge-base.json
```

---

---

## 🎮 Control Commands

```bash
# Code Index (uses 12 cores)
~/.claude/scripts/build-code-index.sh

# Learning Daemon Control
~/.claude/scripts/daemon-control.sh {start|stop|status|restart|logs}

# Check daemon status
~/.claude/scripts/daemon-control.sh status

# View learning logs live
~/.claude/scripts/daemon-control.sh logs
```

## 📊 Active Systems

✅ **Persistent Code Index** - Instant search across all projects
✅ **Multi-Agent Parallel (12 concurrent)** - Auto-dispatch specialized agents
✅ **Learning Daemon (30min cycles)** - Deep intelligence extraction
✅ **12-Core Parallel Tool Execution** - Maximum throughput
✅ **16K Token Output** - 2x response capacity

## ⚡ Max Parallel Configuration

**Tool Calls:** 12 concurrent (was 5) → **140% increase**
**Agents:** 12 concurrent (was 3) → **300% increase**
**Daemon:** 7 functions in parallel → **700% faster learning**
**Output Tokens:** 16,384 (was 8,096) → **2x larger responses**

---

Last Updated: 2025-09-30
System Status: **MAX PARALLEL MODE - 12 CORES FULLY UTILIZED**